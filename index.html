<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TFL Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- Favicons -->
<link rel="icon" type="image/x-icon" href="assets/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
<link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="192x192" href="assets/favicon/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="assets/favicon/android-chrome-512x512.png">

<!-- External Libraries -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- Local Files -->
<link rel="stylesheet" href="styles.css">
<script src="station-data.js"></script>
<script src="tfl-api.js"></script>
<script src="app.js" defer></script>
</head>
<body>

<div class="card container" id="authContainer" style="display: none;">
  <h2 id="authTitle">
    <img src="assets/logos/tfl.png" alt="TFL" class="auth-tfl-logo">
    Welcome to TFL Tracker
  </h2>
  <p id="authSubtitle" style="color: var(--muted); margin-bottom: 20px;">Track your London transport spending</p>
  
  <div class="auth-inputs">
    <input type="email" id="authEmail" placeholder="Email" autocomplete="email">
    <input type="password" id="authPassword" placeholder="Password" autocomplete="current-password">
  </div>
  
  <div class="auth-buttons">
    <button onclick="handleAuth('login')" id="loginBtn">
      <i class="fa-solid fa-right-to-bracket"></i> Login
    </button>
  </div>
  
  <p id="authMessage" style="color: var(--danger); margin-top: 10px; min-height: 20px;"></p>
  
  <div class="auth-footer">
    <a href="https://www.linkedin.com/in/francisarcas/" target="_blank" class="footer-link" title="Francis Arcas LinkedIn">
      <i class="fa-brands fa-linkedin footer-icon"></i>
    </a>
    <span style="margin: 0 10px;">|</span>
    <a href="https://github.com/francisarcas" target="_blank" class="footer-link" title="TFL Tracker GitHub">
      <i class="fa-brands fa-github footer-icon"></i>
    </a>
  </div>
</div>

<div id="appContentWrapper" class="container">
  <div class="top-bar-container">
    <div id="user-menu">
      <input type="checkbox" id="userMenuToggle" />
      <div class="menu-content">
        <img id="userMenuAvatar" class="avatar" src="assets/person001.png" alt="User Avatar">
        <div class="user-info">
          <div id="userMenuGreeting" class="greeting"></div>
          <div id="userMenuUsername" class="username">TFL User</div>
        </div>
        <div class="logout-area">
          <button class="logout-btn" id="logoutButton">
            <i class="fa-solid fa-right-from-bracket"></i>
          </button>
        </div>
      </div>
    </div>
    
    <button class="settings-btn" onclick="openSettings()">
      <i class="fa-solid fa-gear"></i>
    </button>
  </div>

  <h1>
    <img src="assets/logos/tfl.png" alt="TFL" class="tfl-logo">
    Mind the Gap
  </h1>

  <div class="summary-grid">
    <div class="summary-card monthly-spend">
      <div class="label">This Month</div>
      <div class="value" id="currentMonthSpend">£0.00</div>
      <div class="subtext" id="journeyCount">0 journeys</div>
    </div>
    <div class="summary-card" id="comparisonCard">
      <div class="label" id="comparisonLabel">Monthly Card</div>
      <div class="value" id="comparison">-</div>
      <div class="subtext" id="comparisonText">Start tracking to compare</div>
    </div>
    <div class="summary-card" id="dailyCapCard">
      <div class="label">Today's Travel</div>
      <div class="value" id="todaySpend">£0.00</div>
      <div class="subtext" id="capStatus">No journeys today</div>
    </div>
  </div>

  <div class="card">
      <div class="carousel-toggle-header" id="carouselToggleHeader" onclick="toggleCarousel()">
        <span>Stats & Insights</span>
        <i class="fa-solid fa-chevron-down" id="carouselToggleIcon"></i>
      </div>
      
      <div class="carousel-collapsible" id="carouselCollapsible">
        <div class="stats-carousel">
          <button class="carousel-nav carousel-nav-left" id="carouselPrev">
            <i class="fa-solid fa-chevron-left"></i>
          </button>
          
          <div class="carousel-container">
            <div class="carousel-track" id="carouselTrack">
              <!-- Slide 1: Chart -->
              <div class="carousel-slide active">
                <div class="chart-wrapper">
                  <canvas id="spendingChart"></canvas>
                </div>
              </div>
              
              <!-- Slide 2: Top Stations -->
              <div class="carousel-slide">
                <div class="stats-widget">
                  <h3 class="widget-title">
                    <i class="fa-solid fa-location-dot"></i>
                    Most Visited Stations
                  </h3>
                  <div class="stats-list" id="topStationsList">
                    <div class="stats-item">
                      <div class="stats-rank">-</div>
                      <div class="stats-info">
                        <div class="stats-name">No data yet</div>
                        <div class="stats-value">Start tracking to see stats</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Slide 3: Weekly Stats & Transport -->
              <div class="carousel-slide">
                <div class="stats-widget">
                  <h3 class="widget-title">
                    <i class="fa-solid fa-chart-line"></i>
                    Travel Insights
                  </h3>
                  <div class="insight-grid">
                    <div class="insight-card">
                      <div style="width: 100%;">
                        <div class="insight-label">Busiest Week</div>
                        <div class="insight-content">
                          <div class="insight-icon">
                            <i class="fa-solid fa-chart-line" style="font-size: 30px; color: var(--accent1);"></i>
                          </div>
                          <div class="insight-text">
                            <div class="insight-value" id="busiestWeek">-</div>
                            <div class="insight-subtext" id="busiestWeekJourneys">0 journeys</div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="insight-card">
                      <div style="width: 100%;">
                        <div class="insight-label">Favorite Transport</div>
                        <div class="insight-content">
                          <div class="insight-icon" id="favoriteTransportIcon">
                          </div>
                          <div class="insight-text">
                            <div class="insight-value" id="favoriteTransportName">Underground</div>
                            <div class="insight-subtext" id="favoriteTransportCount">0 journeys</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <button class="carousel-nav carousel-nav-right" id="carouselNext">
            <i class="fa-solid fa-chevron-right"></i>
          </button>
        </div>
        
        <!-- Carousel indicators -->
        <div class="carousel-indicators">
          <div class="carousel-dot active" data-slide="0"></div>
          <div class="carousel-dot" data-slide="1"></div>
          <div class="carousel-dot" data-slide="2"></div>
        </div>
      </div>
    </div>


  <div class="card">
    <div class="year-tabs" id="yearTabs"></div>
    <div class="year-month-separator"></div>
    <div class="month-tabs" id="monthTabs"></div>
  </div>

  <div class="card">
    <div class="form">
      <div class="form-group">
        <label>Date & Time</label>
        <input id="dateTimeInput" type="datetime-local" required>
      </div>
      <div class="form-group">
        <label>Transport</label>
        <select id="transportInput">
          <option value="underground">Underground</option>
          <option value="overground">Overground</option>
          <option value="elizabeth">Elizabeth Line</option>
          <option value="tram">Tram</option>
          <option value="bus">Bus</option>
          <option value="dlr">DLR</option>
        </select>
      </div>
      <div class="form-group station-input-wrapper">
        <label id="originLabel">From</label>
        <input id="originInput" type="text" placeholder="Origin station" autocomplete="off">
        <div id="originSuggestions" class="station-suggestions"></div>
      </div>
      <div class="form-group station-input-wrapper" id="destinationGroup">
        <label>To</label>
        <input id="destinationInput" type="text" placeholder="Destination station" autocomplete="off">
        <div id="destinationSuggestions" class="station-suggestions"></div>
      </div>
      <div class="form-group">
        <div class="price-label-wrapper">
          <label>Price</label>
          <div class="loading-indicator" id="priceLoadingIndicator">
            <i class="fa-solid fa-spinner fa-spin"></i>
          </div>
        </div>
        <input id="priceInput" type="number" step="0.01" placeholder="£" required>
      </div>
      <button onclick="addJourney()" id="addJourneyBtn" style="margin-top: 18px;">
        <i class="fa-solid fa-circle-plus"></i>
      </button>
    </div>
  </div>

  <div class="card">
    <div id="journeyList">
      <div class="empty-state">
        <i class="fa-solid fa-train-subway"></i>
        <h3>No journeys yet</h3>
        <p>Add your first journey above to start tracking</p>
      </div>
    </div>
  </div>
</div>

<div id="settingsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Settings</h2>
      <button class="close-btn" onclick="closeSettings()">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    
    <div class="settings-group">
      <label for="homeZoneSelect">Your Home Zone</label>
      <select id="homeZoneSelect">
        <option value="1">Zone 1</option>
        <option value="2">Zone 2</option>
        <option value="3">Zone 3</option>
        <option value="4" selected>Zone 4</option>
        <option value="5">Zone 5</option>
        <option value="6">Zone 6</option>
        <option value="7">Zone 7</option>
        <option value="8">Zone 8</option>
        <option value="9">Zone 9</option>
      </select>
      
      <div class="settings-info">
        <strong>Monthly Travelcard Cost:</strong> <span id="travelcardCostDisplay">£246.60</span><br>
        <small>This is used to compare your contactless spending vs getting an Oyster monthly Travelcard</small>
      </div>
    </div>
    
    <button class="save-settings-btn" onclick="saveSettings()">
      <i class="fa-solid fa-check"></i> Save Settings
    </button>
  </div>
</div>

</body>
</html>
